language: node_js
node_js: "stable"

cache:
  yarn: true
  directories: 
  - node_modules

script:
  - yarn install
  - yarn build
  - yarn test

before_deploy:
  - npm install netlify-cli -g
  - npm run build

deploy:
  provider: pages
  skip-cleanup: true
  github-token: $GITHUB_TOKEN 
  keep-history: true
  local_dir: dist
  on:
    branch: master

deploy:
  provider: surge
  project: dist
  domain: https://fun-with-web-components.surge.sh

deploy:
  provider: script
  script: netlify deploy -s $NETLIFY_SITE_ID -t $NETLIFY_ACCESS_TOKEN -p ./dist
  skip_cleanup: true
  on:
    branch: master